extends layout

block headContent
	title Transaction #{txid}

block content
	if (result && result.transaction)
		h1(class="h2")
			span Transaction
			p(class="monospace text-mu overflow-ellipsis") #{txid}

		ul(class='nav nav-tabs')
			li(class="nav-item")
				a(data-toggle="tab", href="#tab-summary", class="nav-link active", role="tab") Summary
			li(class="nav-item")
				a(data-toggle="tab", href="#tab-scripts", class="nav-link", role="tab") Scripts
			li(class="nav-item")
				a(data-toggle="tab", href="#tab-raw", class="nav-link", role="tab") Raw

		- DecimalRounded = Decimal.clone({ precision: 4, rounding: 2 })

		- var totalInputValue = result.transaction.totalInputValue
		- var totalOutputValue = result.transaction.totalOutputValue
		- var fee = result.transaction.fee

		div(class="tab-content")
			div(id="tab-summary", class="tab-pane active", role="tabpanel")
				if (result.transaction.vin[0].coinbase && result.getblock.height == 0)
					div(class="alert alert-warning", style="padding-bottom: 0;")
						h4(class="alert-heading h5") This transaction doesn't really exist!
							:markdown-it
								This is the coinbase transaction of the [Genesis Block](/block/f2b80b27fdcd3b9047de882c4ad0c72a9d875919aedccba7f6cdc6c994fcdf02).

				div(class="table-container mb-2r")
					table(class="table table--primary")
						tr
							th(class="table-active properties-header") Included in Block
								td(class="monospace")
									if (result.getblock)
										a(href=("/block/" + result.transaction.blockhash)) #{result.transaction.blockhash}
											if (result.getblock.height)
												span(class="text-muted")  (#{result.getblock.height.toLocaleString()})
									else
										span N/A
										span(class="text-muted")  (unconfirmed)

						tr
							th(class="table-active properties-header") Timestamp
							if (result.transaction.time)
								td(class="monospace") #{moment.utc(new Date(result.transaction["time"] * 1000)).format("DD-MM-YYYY HH:mm:ss")} UTC
							else
								td(class="monospace") N/A
								span(class="text-muted")  (unconfirmed)

						tr
							th(class="table-active properties-header") Version
							td(class="monospace") #{result.transaction.version}

						tr
							th(class="table-active properties-header") Size
							td(class="monospace")
								span #{result.transaction.size.toLocaleString()} bytes
								if (result.transaction.vsize != result.transaction.size)
									span  (
									a(href="https://github.com/bitcoin/bips/blob/master/bip-0141.mediawiki#Transaction_size_calculations") virtual size
									span : #{result.transaction.vsize.toLocaleString()} bytes)

						if (result.transaction.locktime > 0)
							tr
								th(class="table-active properties-header")
									span Locktime
								td(class="monospace")
									if (result.transaction.locktime < 500000000)
										span Spendable in block
										a(href=("/block-height/" + result.transaction.locktime))  #{result.transaction.locktime}
										span  or later
									else
										span Spendable after #{moment.utc(new Date(result.transaction.locktime * 1000)).format("DD-MM-YYYY HH:mm:ss")} UTC

						if (result.transaction.vin[0].coinbase)
							tr
								th(class="table-active properties-header") Total Network Fees
								td(class="monospace") #{new Decimal(totalOutputValue).minus(totalInputValue)}
						else
							tr
								th(class="table-active properties-header") Network Fee Paid
								td(class="monospace")
									strong #{fee}
									br
									span ~#{new DecimalRounded(fee).dividedBy(result.transaction.size).times(100000000)} sat/B

				div(class="row")
					div(class="col-md-6")
						include includes/transaction-table-input.pug

					div(class="col-md-6")
						include includes/transaction-table-output.pug

			div(id="tab-scripts", class="tab-pane", role="tabpanel")
				h6 Input Scripts
				div(class="table-container mb-1r")
					table(class="table table--secondary")
						thead
							tr
								th(style="width: 50px;")
								th Script Sig (asm)
						tbody
							each vin, vinIndex in result.transaction.vin
								tr
									th #{vinIndex + 1}
									td
										if (vin.scriptSig && vin.scriptSig.asm)
											span(class="word-wrap monospace") #{vin.scriptSig.asm}

										else if (vin.coinbase)
											div(style="line-height: 1.75em;")
												span(class="tag") coinbase
												br
												span(class="word-wrap monospace") #{vin.coinbase}
												br
												span(class="word-wrap monospace text-muted") (decoded) #{utils.hex2ascii(vin.coinbase)}

				h6 Output Scripts
				div(class="table-container mb-1r")
					table(class="table table--secondary")
						thead
							tr
								th(style="width: 50px;")
								th Script Pub Key (asm)
						tbody
							each vout, voutIndex in result.transaction.vout
								tr
									th #{voutIndex + 1}
									td
										if (vout.scriptPubKey && vout.scriptPubKey.asm)
											span(class="word-wrap monospace") #{vout.scriptPubKey.asm}
											if (vout.scriptPubKey.asm.startsWith("OP_RETURN"))
												br
												span(class="word-wrap monospace text-muted") (decoded) #{utils.hex2ascii(vout.scriptPubKey.asm)}

			div(id="tab-raw", class="tab-pane", role="tabpanel")
				div(class="highlight")
					pre
						code(class="language-json", data-lang="json") #{JSON.stringify(result.transaction, null, 4)}
